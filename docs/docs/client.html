<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GraphQL Client | Caliban</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/caliban/caliban.png">
    <meta name="description" content="Functional GraphQL library for Scala">
    
    <link rel="preload" href="/caliban/assets/css/0.styles.5378620b.css" as="style"><link rel="preload" href="/caliban/assets/js/app.3a7a93d3.js" as="script"><link rel="preload" href="/caliban/assets/js/2.ec7a7ec7.js" as="script"><link rel="preload" href="/caliban/assets/js/10.7af6dc02.js" as="script"><link rel="prefetch" href="/caliban/assets/js/11.ea330d04.js"><link rel="prefetch" href="/caliban/assets/js/12.cebc1afe.js"><link rel="prefetch" href="/caliban/assets/js/13.5368a538.js"><link rel="prefetch" href="/caliban/assets/js/14.a44d9989.js"><link rel="prefetch" href="/caliban/assets/js/15.862471cc.js"><link rel="prefetch" href="/caliban/assets/js/16.5ab2d121.js"><link rel="prefetch" href="/caliban/assets/js/17.9730cd10.js"><link rel="prefetch" href="/caliban/assets/js/18.9ae12422.js"><link rel="prefetch" href="/caliban/assets/js/19.26bfd94c.js"><link rel="prefetch" href="/caliban/assets/js/20.10977ce8.js"><link rel="prefetch" href="/caliban/assets/js/21.dc526bc7.js"><link rel="prefetch" href="/caliban/assets/js/22.d916a1dd.js"><link rel="prefetch" href="/caliban/assets/js/3.1a790ed9.js"><link rel="prefetch" href="/caliban/assets/js/4.97c039ba.js"><link rel="prefetch" href="/caliban/assets/js/5.c31107b6.js"><link rel="prefetch" href="/caliban/assets/js/6.004ca1a2.js"><link rel="prefetch" href="/caliban/assets/js/7.2e2085cc.js"><link rel="prefetch" href="/caliban/assets/js/8.f9d21a25.js"><link rel="prefetch" href="/caliban/assets/js/9.e23384d3.js">
    <link rel="stylesheet" href="/caliban/assets/css/0.styles.5378620b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/caliban/" class="home-link router-link-active"><img src="/caliban/caliban.svg" alt="Caliban" class="logo"> <span class="site-name can-hide">Caliban</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/caliban/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/caliban/resources/" class="nav-link">
  Resources
</a></div><div class="nav-item"><a href="/caliban/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/caliban/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/ghostdogpr/caliban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://javadoc.io/doc/com.github.ghostdogpr/caliban_2.12/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Scaladoc
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/caliban/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/caliban/resources/" class="nav-link">
  Resources
</a></div><div class="nav-item"><a href="/caliban/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/caliban/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/ghostdogpr/caliban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://javadoc.io/doc/com.github.ghostdogpr/caliban_2.12/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Scaladoc
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Caliban</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/caliban/docs/" aria-current="page" class="sidebar-link">Getting Started</a></li><li><a href="/caliban/docs/schema.html" class="sidebar-link">Schemas</a></li><li><a href="/caliban/docs/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/caliban/docs/optimization.html" class="sidebar-link">Query optimization</a></li><li><a href="/caliban/docs/validation.html" class="sidebar-link">Validation</a></li><li><a href="/caliban/docs/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/caliban/docs/interop.html" class="sidebar-link">Interop</a></li><li><a href="/caliban/docs/client.html" aria-current="page" class="active sidebar-link">GraphQL Client</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#dependencies" class="sidebar-link">Dependencies</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#code-generation" class="sidebar-link">Code generation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#from-a-schema-file" class="sidebar-link">From a schema file</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#from-a-server-url" class="sidebar-link">From a server URL</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#calibansetting-config-parameters" class="sidebar-link">calibanSetting config parameters</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#calibangenclient" class="sidebar-link">calibanGenClient</a></li></ul></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#query-building" class="sidebar-link">Query building</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#automated-generation-of-a-view-projection" class="sidebar-link">Automated generation of a view projection</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#request-execution" class="sidebar-link">Request execution</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/client.html#laminext-integration" class="sidebar-link">Laminext Integration</a></li></ul></li><li><a href="/caliban/docs/federation.html" class="sidebar-link">Federation</a></li><li><a href="/caliban/docs/stitching.html" class="sidebar-link">Stitching</a></li><li><a href="/caliban/docs/tools.html" class="sidebar-link">Tools</a></li><li><a href="/caliban/docs/examples.html" class="sidebar-link">Examples</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="graphql-client"><a href="#graphql-client" class="header-anchor">#</a> GraphQL Client</h1> <p><strong>Caliban-client</strong> is a module independent from Caliban that makes it possible to write GraphQL queries using Scala code in a type-safe and functional fashion. It is built on top of <a href="https://github.com/softwaremill/sttp" target="_blank" rel="noopener noreferrer">sttp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which means you can run requests using the backend of your choice.</p> <p>Just like Caliban, <code>caliban-client</code> offers a purely functional interface and keeps the boilerplate minimal. It works as follows:</p> <ol><li>Use the <code>caliban-codegen-sbt</code> tool to generate boilerplate code from a given GraphQL schema</li> <li>Write your GraphQL query/mutation by combining helpers from the generated code</li> <li>Transform your query/mutation into an <code>sttp</code> request and run it with your preferred backend</li></ol> <h2 id="dependencies"><a href="#dependencies" class="header-anchor">#</a> Dependencies</h2> <p>To use <code>caliban-client</code>, add the following line in your <code>build.sbt</code> file:</p> <div class="language- extra-class"><pre class="language-text"><code>libraryDependencies += &quot;com.github.ghostdogpr&quot; %% &quot;caliban-client&quot; % &quot;1.1.0&quot;
</code></pre></div><p>Caliban-client is available for ScalaJS. To use it in a ScalaJS project, instead add this line to your <code>build.sbt</code> file:</p> <div class="language- extra-class"><pre class="language-text"><code>libraryDependencies += &quot;com.github.ghostdogpr&quot; %%% &quot;caliban-client&quot; % &quot;1.1.0&quot;
</code></pre></div><h2 id="code-generation"><a href="#code-generation" class="header-anchor">#</a> Code generation</h2> <p>The first step for building GraphQL queries with <code>caliban-client</code> is to generate boilerplate code from a GraphQL schema. For that, you need a file containing your schema (if your backend uses <code>caliban</code>, you can get it by calling <code>GraphQL#render</code> on your API).</p> <p>To use this feature, add the <code>caliban-codegen-sbt</code> sbt plugin to your <code>project/plugins.sbt</code> file:</p> <div class="language-scala extra-class"><pre class="language-scala"><code>addSbtPlugin<span class="token punctuation">(</span><span class="token string">&quot;com.github.ghostdogpr&quot;</span> <span class="token operator">%</span> <span class="token string">&quot;caliban-codegen-sbt&quot;</span> <span class="token operator">%</span> <span class="token string">&quot;1.1.0&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>And enable it in your <code>build.sbt</code> file:</p> <div class="language-scala extra-class"><pre class="language-scala"><code>enablePlugins<span class="token punctuation">(</span>CalibanPlugin<span class="token punctuation">)</span>
</code></pre></div><h3 id="from-a-schema-file"><a href="#from-a-schema-file" class="header-anchor">#</a> From a schema file</h3> <p>At this point, the <code>caliban</code> command will cause any files in <code>src/main/graphql</code> to be translated into a Caliban-generated client library. This happens automatically any time you <code>compile</code>.</p> <p>By default, all clients are generated with the same client name as the source file, in the <code>caliban</code> top-level package.</p> <p>In order to supply more configuration options to the code generator, you can use the <code>calibanSettings</code> sbt setting, combined with the <code>calibanSetting</code> function to scope the settings to a particular file:</p> <div class="language-scala extra-class"><pre class="language-scala"><code>      <span class="token comment">// The `file(&quot;Service.graphql&quot;)` is a path suffix for some file in `src/main/graphql`</span>
      Compile <span class="token operator">/</span> caliban <span class="token operator">/</span> calibanSettings <span class="token operator">+=</span> calibanSetting<span class="token punctuation">(</span>file<span class="token punctuation">(</span><span class="token string">&quot;Service.graphql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
        cs <span class="token keyword">=&gt;</span>
          cs<span class="token punctuation">.</span>packageName<span class="token punctuation">(</span><span class="token string">&quot;com.example.graphql.client&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>scalarMapping<span class="token punctuation">(</span>
              <span class="token string">&quot;LanguageCode&quot;</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;com.example.models.LanguageCode&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span>scalarMapping<span class="token punctuation">(</span>
              <span class="token string">&quot;Timestamp&quot;</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;java.sql.Timestamp&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;DayOfWeek&quot;</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;java.time.DayOfWeek&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;IntRange&quot;</span>  <span class="token operator">-&gt;</span> <span class="token string">&quot;com.github.tminglei.slickpg.Range[Int]&quot;</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span>imports<span class="token punctuation">(</span><span class="token string">&quot;com.example.graphql.client.implicits._&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
</code></pre></div><h3 id="from-a-server-url"><a href="#from-a-server-url" class="header-anchor">#</a> From a server URL</h3> <p>The <code>calibanSetting</code> function also permits generating clients for supplied <code>url</code>'s:</p> <div class="language-scala extra-class"><pre class="language-scala"><code>      Compile <span class="token operator">/</span> caliban <span class="token operator">/</span> calibanSettings <span class="token operator">+=</span> calibanSetting<span class="token punctuation">(</span>url<span class="token punctuation">(</span><span class="token string">&quot;http://my-example-service/graphql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
        cs <span class="token keyword">=&gt;</span>
          cs<span class="token punctuation">.</span>clientName<span class="token punctuation">(</span><span class="token string">&quot;ExampleServiceClient&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>packageName<span class="token punctuation">(</span><span class="token string">&quot;com.example.graphql.client&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
</code></pre></div><h3 id="calibansetting-config-parameters"><a href="#calibansetting-config-parameters" class="header-anchor">#</a> <code>calibanSetting</code> config parameters</h3> <p>The settings available on the <code>cs</code> (<code>CalibanSettings</code>) builder are:</p> <div class="language- extra-class"><pre class="language-text"><code>  def scalafmtPath(path: String): CalibanSettings               // Path to a scalafmt config (default: .scalafmt.conf)
  def packageName(name: String): CalibanSettings                // Which package to put the generated clients in (default: caliban)
  def genView(value: Boolean): CalibanSettings                  // Provide a case class and helper method to select all fields on an object (default: false)
  def scalarMapping(mapping: (String,String)*): CalibanSettings // A mapping from GraphQL scalar types to JVM types, as unknown scalar types are represented as String by default.
  def imports(values: String*): CalibanSettings                 // A list of imports to be added to the top of a generated client
  def splitFiles(value: Boolean): CalibanSettings               // Split single client object into multiple files (default: false)
  def enableFmt(value: Boolean): CalibanSettings                // Enable code formatting with scalafmt (default: true)

  // Only defined for `url` settings, for use in supplying extra headers when fetching the schema itself
  def headers(pairs: (String,String)*): CalibanSettings
</code></pre></div><h3 id="calibangenclient"><a href="#calibangenclient" class="header-anchor">#</a> <code>calibanGenClient</code></h3> <p>If you prefer to generate the client explicitly rather than automatically, you can use <code>calibanGenClient</code> on the SBT CLI as follows:</p> <div class="language-scala extra-class"><pre class="language-scala"><code>calibanGenClient schemaPath outputPath <span class="token punctuation">[</span><span class="token operator">--</span>scalafmtPath path<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>headers name<span class="token operator">:</span>value<span class="token punctuation">,</span>name2<span class="token operator">:</span>value2<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>genView <span class="token boolean">true</span><span class="token operator">|</span><span class="token boolean">false</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>scalarMappings gqlType<span class="token operator">:</span>f<span class="token punctuation">.</span>q<span class="token punctuation">.</span>d<span class="token punctuation">.</span>n<span class="token punctuation">.</span>Type<span class="token punctuation">,</span>gqlType2<span class="token operator">:</span>f<span class="token punctuation">.</span>q<span class="token punctuation">.</span>d<span class="token punctuation">.</span>n<span class="token punctuation">.</span>Type2<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>imports a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">.</span>_<span class="token punctuation">,</span>c<span class="token punctuation">.</span>d<span class="token punctuation">.</span>E<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>splitFiles <span class="token boolean">true</span><span class="token operator">|</span><span class="token boolean">false</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">--</span>enableFmt <span class="token boolean">true</span><span class="token operator">|</span><span class="token boolean">false</span><span class="token punctuation">]</span>

calibanGenClient project<span class="token operator">/</span>schema<span class="token punctuation">.</span>graphql src<span class="token operator">/</span>main<span class="token operator">/</span>client<span class="token operator">/</span>Client<span class="token punctuation">.</span>scala <span class="token operator">--</span>genView <span class="token boolean">true</span>  
</code></pre></div><p>This command will generate a Scala file in <code>outputPath</code> containing helper functions for all the types defined in the provided GraphQL schema defined at <code>schemaPath</code>.
If you need to disable generating clients from <code>src/main/graphql</code>, please include <code>Compile / caliban / calibanGenerator := Seq.empty</code> in your project settings.
Instead of a file, you can provide a URL and the schema will be obtained using introspection.
The generated code will be formatted with Scalafmt using the configuration defined by <code>--scalafmtPath</code> option (default: <code>.scalafmt.conf</code>).
If you provide a URL for <code>schemaPath</code>, you can provide request headers with <code>--headers</code> option.
The package of the generated code is derived from the folder of <code>outputPath</code>.
This can be overridden by providing an alternative package with the <code>--packageName</code>
option.
Provide <code>--genView true</code> option if you want to generate a view for the GraphQL types.
If you want to force a mapping between a GraphQL type and a Scala class (such as scalars), you can use the
<code>--scalarMappings</code> option. Also you can add imports for example for your ArgEncoder implicits by providing <code>--imports</code> option.
Use the <code>--splitFiles true</code> option if you want to generate multiple files within the same package instead of a single file.
In this case the filename part of the <code>outputPath</code> will be ignored, but the value will still be used to determine the mandatory package name and the destination directory.
This can be helpful with large GraphQL schemas and incremental compilation.
Provide <code>--enableFmt false</code> option if you don't need to format generated files.</p> <h2 id="query-building"><a href="#query-building" class="header-anchor">#</a> Query building</h2> <p>Once the boilerplate code is generated, you can start building queries. For each <em>type</em> in your schema, a corresponding Scala object has been created. For each <em>field</em> in your schema, a corresponding Scala function has been created.</p> <p>For example, given the following schema:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
  <span class="token attr-name">nicknames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
  <span class="token attr-name">origin</span><span class="token punctuation">:</span> <span class="token class-name">Origin</span><span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Your generated code will have the following:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">object</span> Character <span class="token punctuation">{</span>
  <span class="token keyword">def</span> name<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span>            <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>
  <span class="token keyword">def</span> nicknames<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>
  <span class="token keyword">def</span> origin<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> Origin<span class="token punctuation">]</span>          <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A <code>SelectionBuilder[Origin, A]</code> is a selection from a parent type <code>Origin</code> that returns a result of type <code>A</code>. In this example, <code>name</code> is a selection from a <code>Character</code> that returns a <code>String</code>.</p> <p>You can combine multiple selections using the <code>~</code> operator. The new result type will be a tuple from the 2 combined result types. Note that you can only combine selections that have the same origin.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> selection<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  Character<span class="token punctuation">.</span>name <span class="token operator">~</span> Character<span class="token punctuation">.</span>nicknames
</code></pre></div><p>If you combine multiple fields, it is more convenient to have a case class to represent your data (to avoid seeing nested tuples). You can use <code>mapN</code> to map a nested tuple to a case class.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">case</span> <span class="token keyword">class</span> CharacterView<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> nickname<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span> origin<span class="token operator">:</span> Origin<span class="token punctuation">)</span>

<span class="token keyword">val</span> character<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> CharacterView<span class="token punctuation">]</span> <span class="token operator">=</span>
  <span class="token punctuation">(</span>Character<span class="token punctuation">.</span>name <span class="token operator">~</span> Character<span class="token punctuation">.</span>nicknames <span class="token operator">~</span> Character<span class="token punctuation">.</span>origin<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>mapN<span class="token punctuation">(</span>CharacterView<span class="token punctuation">)</span>
</code></pre></div><p>Fields that return an object type will require an inner selection, which is another <code>SelectionBuilder</code>. Let's consider the following <code>Query</code> type.</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">characters</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Character</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When calling <code>characters</code>, we need to provide a <code>SelectionBuilder[Character, ?]</code> to indicate which fields to select on the returned <code>Character</code>.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> query<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>RootQuery<span class="token punctuation">,</span> List<span class="token punctuation">[</span>CharacterView<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  Query<span class="token punctuation">.</span>characters <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>Character<span class="token punctuation">.</span>name <span class="token operator">~</span> Character<span class="token punctuation">.</span>nicknames <span class="token operator">~</span> Character<span class="token punctuation">.</span>origin<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>mapN<span class="token punctuation">(</span>CharacterView<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>Or if we reuse the <code>character</code> selection we just created:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> query<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>RootQuery<span class="token punctuation">,</span> List<span class="token punctuation">[</span>CharacterView<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  Query<span class="token punctuation">.</span>characters <span class="token punctuation">{</span>
    character
  <span class="token punctuation">}</span>
</code></pre></div><p>Because this is Scala code, you can easily reuse a selection in multiple places without having to worry about GraphQL fragments. The Scala compiler will also make sure that you only combine fields that make sense.</p> <p>When a field requires an argument, the helper method for the field will require one as well. Let's enrich our query:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">characters</span><span class="token punctuation">(</span><span class="token attr-name">origin</span><span class="token punctuation">:</span> <span class="token class-name">Origin</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Character</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You now need to provide an <code>Origin</code> when calling <code>characters</code>:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> query<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>RootQuery<span class="token punctuation">,</span> List<span class="token punctuation">[</span>CharacterView<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  Query<span class="token punctuation">.</span>characters<span class="token punctuation">(</span>Origin<span class="token punctuation">.</span>MARS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    character
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="automated-generation-of-a-view-projection"><a href="#automated-generation-of-a-view-projection" class="header-anchor">#</a> Automated generation of a view projection</h2> <p><code>ClientWriter</code> can generate a view projection for a GraphQL type.</p> <p>For example, given the following schema:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Origin</span> <span class="token punctuation">{</span>
  <span class="token attr-name">description</span><span class="token punctuation">:</span> <span class="token scalar">String</span>
  <span class="token attr-name">details</span><span class="token punctuation">:</span> <span class="token scalar">String</span>  
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
  <span class="token attr-name">nicknames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
  <span class="token attr-name">origin</span><span class="token punctuation">(</span><span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Origin</span><span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Your generated code will have the following:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">type</span> Origin
<span class="token keyword">object</span> Origin <span class="token punctuation">{</span>

  <span class="token keyword">final</span> <span class="token keyword">case</span> <span class="token keyword">class</span> OriginView<span class="token punctuation">(</span>description<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span> details<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">type</span> ViewSelection <span class="token operator">=</span> SelectionBuilder<span class="token punctuation">[</span>Origin<span class="token punctuation">,</span> OriginView<span class="token punctuation">]</span>

  <span class="token keyword">def</span> view<span class="token operator">:</span> ViewSelection <span class="token operator">=</span> <span class="token punctuation">(</span>description <span class="token operator">~</span> details<span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token keyword">case</span> <span class="token punctuation">(</span>description<span class="token punctuation">,</span> details<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
    OriginView<span class="token punctuation">(</span>description<span class="token punctuation">,</span> details<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

  <span class="token keyword">def</span> description<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Origin<span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> OptionOf<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">def</span> details<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Origin<span class="token punctuation">,</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span>     <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token string">&quot;details&quot;</span><span class="token punctuation">,</span> OptionOf<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Character
<span class="token keyword">object</span> Character <span class="token punctuation">{</span>

  <span class="token keyword">final</span> <span class="token keyword">case</span> <span class="token keyword">class</span> CharacterView<span class="token punctuation">[</span>OriginSelection<span class="token punctuation">]</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> nicknames<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span> origin<span class="token operator">:</span> OriginSelection<span class="token punctuation">)</span>

  <span class="token keyword">type</span> ViewSelection<span class="token punctuation">[</span>OriginSelection<span class="token punctuation">]</span> <span class="token operator">=</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> CharacterView<span class="token punctuation">[</span>OriginSelection<span class="token punctuation">]</span><span class="token punctuation">]</span>

  <span class="token keyword">def</span> view<span class="token punctuation">[</span>OriginSelection<span class="token punctuation">]</span><span class="token punctuation">(</span>originFilter<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> None<span class="token punctuation">)</span><span class="token punctuation">(</span>
    originSelection<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Origin<span class="token punctuation">,</span> OriginSelection<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> ViewSelection<span class="token punctuation">[</span>OriginSelection<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">~</span> nicknames <span class="token operator">~</span> origin<span class="token punctuation">(</span>originFilter<span class="token punctuation">)</span><span class="token punctuation">(</span>originSelection<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> nicknames<span class="token punctuation">)</span><span class="token punctuation">,</span> origin<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> CharacterView<span class="token punctuation">(</span>name<span class="token punctuation">,</span> nicknames<span class="token punctuation">,</span> origin<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">def</span> name<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span>            <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">def</span> nicknames<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Field<span class="token punctuation">(</span><span class="token string">&quot;nicknames&quot;</span><span class="token punctuation">,</span> ListOf<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">def</span> origin<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">(</span>
    filter<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> None
  <span class="token punctuation">)</span><span class="token punctuation">(</span>innerSelection<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Origin<span class="token punctuation">,</span> A<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> A<span class="token punctuation">]</span> <span class="token operator">=</span>
    Field<span class="token punctuation">(</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">,</span> Obj<span class="token punctuation">(</span>innerSelection<span class="token punctuation">)</span><span class="token punctuation">,</span> arguments <span class="token operator">=</span> List<span class="token punctuation">(</span>Argument<span class="token punctuation">(</span><span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then you can build a query the way you want:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> characterWithOriginAllFields<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> Character<span class="token punctuation">.</span>CharacterView<span class="token punctuation">[</span>Origin<span class="token punctuation">.</span>View<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  Character<span class="token punctuation">.</span>view<span class="token punctuation">(</span>None<span class="token punctuation">)</span><span class="token punctuation">(</span>Origin<span class="token punctuation">.</span>view<span class="token punctuation">)</span>

<span class="token keyword">val</span> characterWithOriginOnlyDetails<span class="token operator">:</span> SelectionBuilder<span class="token punctuation">[</span>Character<span class="token punctuation">,</span> Character<span class="token punctuation">.</span>CharacterView<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
  Character<span class="token punctuation">.</span>view<span class="token punctuation">(</span>Some<span class="token punctuation">(</span><span class="token string">&quot;some filter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Origin<span class="token punctuation">.</span>details<span class="token punctuation">)</span>
</code></pre></div><h2 id="request-execution"><a href="#request-execution" class="header-anchor">#</a> Request execution</h2> <p>Once your query or mutation is created, it is time to execute it. To do that, you can transform your <code>SelectionBuilder</code> into an <code>sttp</code> request by calling <code>.toRequest</code>.</p> <p>This function takes the URL of your GraphQL server and some options:</p> <ul><li>a boolean <code>useVariables</code> that determines if arguments should be using variables or not (default: false)</li> <li>an optional string <code>queryName</code> if you want to name your query (default: no name)</li> <li>a boolean <code>dropNullInputValues</code> that determines if null fields from input objects should be dropped (default: false)</li></ul> <p>You can then simply run the <code>sttp</code> request with the backend of your choice. See the <a href="https://sttp.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">sttp docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> if you are not familiar with it.</p> <p>Here is an example using the <code>AsyncHttpClient</code> backend for <code>ZIO</code>:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">sttp<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>_
<span class="token keyword">import</span> <span class="token namespace">sttp<span class="token punctuation">.</span>client<span class="token punctuation">.</span>asynchttpclient<span class="token punctuation">.</span>zio<span class="token punctuation">.</span></span>AsyncHttpClientZioBackend

AsyncHttpClientZioBackend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatMap <span class="token punctuation">{</span> <span class="token keyword">implicit</span> backend <span class="token keyword">=&gt;</span>
  <span class="token keyword">val</span> serverUrl <span class="token operator">=</span> uri<span class="token string">&quot;http://localhost:8088/api/graphql&quot;</span>
  <span class="token keyword">val</span> result<span class="token operator">:</span> Task<span class="token punctuation">[</span>List<span class="token punctuation">[</span>CharacterView<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    query<span class="token punctuation">.</span>toRequest<span class="token punctuation">(</span>serverUrl<span class="token punctuation">)</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span>absolve
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As a result, we get a ZIO <code>Task</code> whose return type is the same as our <code>SelectionBuilder</code>. The sttp request does not only contain the request to send, but also takes care of parsing the response into the expected type.</p> <p>The <a href="https://github.com/ghostdogpr/caliban/tree/master/examples/" target="_blank" rel="noopener noreferrer">examples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> project contains a runnable sample code that queries the example GraphQL backend.</p> <div class="custom-block warning"><p class="custom-block-title">Limitations</p> <p>Only Queries and Mutations are supported as sttp requests.
Subscriptions are supported in the laminext module, and this code can easily be adapted to other frameworks (the relevant code is only a few lines long).</p> <p>Type extensions are not supported by the codegen tool.</p></div> <h2 id="laminext-integration"><a href="#laminext-integration" class="header-anchor">#</a> Laminext Integration</h2> <p>If you are using the Scala.js framework <a href="https://laminar.dev" target="_blank" rel="noopener noreferrer">Laminar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, there is a module that makes the integration even nicer, with support for subscriptions.
It is depending on <a href="https://laminext.dev" target="_blank" rel="noopener noreferrer">Laminext<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, a library that provides nice little helpers for Laminar, in particular for using <code>Fetch</code> and <code>WebSocket</code>.</p> <p>To use it, import the <code>caliban-client-laminext</code> module:</p> <div class="language- extra-class"><pre class="language-text"><code>libraryDependencies += &quot;com.github.ghostdogpr&quot; %%% &quot;caliban-client-laminext&quot; % &quot;1.1.0&quot;
</code></pre></div><p>Add the following import to your code:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">caliban<span class="token punctuation">.</span>client<span class="token punctuation">.</span>laminext<span class="token punctuation">.</span></span>_
</code></pre></div><p>This import adds an extension method <code>toEventStream(uri)</code> to <code>SelectionBuilder</code>, which is similar to <code>toRequest</code> except it creates an <code>EventStream</code> instead of an sttp <code>Request</code>.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> characters<span class="token operator">:</span> Var<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> Var<span class="token punctuation">(</span>Nil<span class="token punctuation">)</span>

<span class="token keyword">val</span> uri <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8088/api/graphql&quot;</span>

<span class="token keyword">val</span> getCharacters <span class="token operator">=</span> Queries<span class="token punctuation">.</span>characters<span class="token punctuation">(</span>None<span class="token punctuation">)</span><span class="token punctuation">(</span>Client<span class="token punctuation">.</span>Character<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>toEventStream<span class="token punctuation">(</span>uri<span class="token punctuation">)</span>

<span class="token keyword">val</span> view<span class="token operator">:</span> Div <span class="token operator">=</span> 
  div<span class="token punctuation">(</span>
    <span class="token string">&quot;Characters: &quot;</span><span class="token punctuation">,</span>
    getCharacters<span class="token punctuation">.</span>collectRight <span class="token operator">--</span><span class="token operator">&gt;</span> characters<span class="token punctuation">.</span>set _<span class="token punctuation">,</span>
    child <span class="token keyword">&lt;-</span><span class="token operator">-</span> characters<span class="token punctuation">.</span>signal<span class="token punctuation">.</span>map<span class="token punctuation">(</span>c <span class="token keyword">=&gt;</span> div<span class="token punctuation">(</span>c<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
</code></pre></div><p>To use subscriptions, you first need to create a <code>WebSocket</code> with protocol <code>graphql-ws</code>. Use the extension method <code>.graphql</code> instead of <code>.text</code> or <code>.json</code>.
Then use the extension method <code>toSubscription</code> on your <code>SelectionBuilder</code> and pass the <code>WebSocket</code> object.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> ws <span class="token operator">=</span> WebSocket<span class="token punctuation">.</span>url<span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8088/ws/graphql&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;graphql-ws&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>graphql<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> deletedCharacters <span class="token operator">=</span> Subscriptions<span class="token punctuation">.</span>characterDeleted<span class="token punctuation">.</span>toSubscription<span class="token punctuation">(</span>ws<span class="token punctuation">)</span>
</code></pre></div><p>Finally, you can use <code>ws.connect</code> to connect the <code>WebSocket</code>, <code>ws.init()</code> to initialize the communication with the graphql server and <code>.received</code> to get an <code>EventStream</code> of the type returned by your subscription.</p> <div class="language-scala extra-class"><pre class="language-scala"><code>ws<span class="token punctuation">.</span>connect<span class="token punctuation">,</span>
ws<span class="token punctuation">.</span>connected <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>_ <span class="token keyword">=&gt;</span> ws<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
deletedCharacters<span class="token punctuation">.</span>received<span class="token punctuation">.</span>collectRight <span class="token operator">--</span><span class="token operator">&gt;</span> 
  <span class="token punctuation">(</span>name <span class="token keyword">=&gt;</span> characters<span class="token punctuation">.</span>update<span class="token punctuation">(</span>_<span class="token punctuation">.</span>filterNot<span class="token punctuation">(</span>_ <span class="token operator">==</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><p>There is a full example in the <code>test</code> folder of the <code>caliban-client-laminext</code> module.
To use it:</p> <ul><li>run <code>ExampleApp</code> of the http4s server example (it supports CORS)</li> <li>run <code>clientLaminextJS/Test/fastLinkJS</code> to compile the Scala.js code</li> <li>run <code>yarn install</code> and <code>yarn exec vite</code> in the <code>caliban-client-laminext</code> folder</li> <li>the example page will be running on <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/caliban/docs/interop.html" class="prev">
        Interop
      </a></span> <span class="next"><a href="/caliban/docs/federation.html">
        Federation
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/caliban/assets/js/app.3a7a93d3.js" defer></script><script src="/caliban/assets/js/2.ec7a7ec7.js" defer></script><script src="/caliban/assets/js/10.7af6dc02.js" defer></script>
  </body>
</html>

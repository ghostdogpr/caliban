<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stitching | Caliban</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/caliban/caliban.png">
    <meta name="description" content="Functional GraphQL library for Scala">
    
    <link rel="preload" href="/caliban/assets/css/0.styles.5378620b.css" as="style"><link rel="preload" href="/caliban/assets/js/app.c9beaf5a.js" as="script"><link rel="preload" href="/caliban/assets/js/2.caf3e0bc.js" as="script"><link rel="preload" href="/caliban/assets/js/18.e3d75065.js" as="script"><link rel="prefetch" href="/caliban/assets/js/10.5aa9b0f0.js"><link rel="prefetch" href="/caliban/assets/js/11.f3bf0108.js"><link rel="prefetch" href="/caliban/assets/js/12.3bea9ac4.js"><link rel="prefetch" href="/caliban/assets/js/13.4eb72b62.js"><link rel="prefetch" href="/caliban/assets/js/14.51224088.js"><link rel="prefetch" href="/caliban/assets/js/15.126379cb.js"><link rel="prefetch" href="/caliban/assets/js/16.9e329d2b.js"><link rel="prefetch" href="/caliban/assets/js/17.41547507.js"><link rel="prefetch" href="/caliban/assets/js/19.92035a9f.js"><link rel="prefetch" href="/caliban/assets/js/20.daa52ffd.js"><link rel="prefetch" href="/caliban/assets/js/21.6563d4da.js"><link rel="prefetch" href="/caliban/assets/js/22.724ace4d.js"><link rel="prefetch" href="/caliban/assets/js/3.cc5ee1dd.js"><link rel="prefetch" href="/caliban/assets/js/4.b5c5d85a.js"><link rel="prefetch" href="/caliban/assets/js/5.aedbb9bc.js"><link rel="prefetch" href="/caliban/assets/js/6.7dd3e1f3.js"><link rel="prefetch" href="/caliban/assets/js/7.00cd415f.js"><link rel="prefetch" href="/caliban/assets/js/8.f886d4ab.js"><link rel="prefetch" href="/caliban/assets/js/9.f82d2f99.js">
    <link rel="stylesheet" href="/caliban/assets/css/0.styles.5378620b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/caliban/" class="home-link router-link-active"><img src="/caliban/caliban.svg" alt="Caliban" class="logo"> <span class="site-name can-hide">Caliban</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/caliban/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/caliban/resources/" class="nav-link">
  Resources
</a></div><div class="nav-item"><a href="/caliban/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/caliban/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/ghostdogpr/caliban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://javadoc.io/doc/com.github.ghostdogpr/caliban_2.12/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Scaladoc
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/caliban/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/caliban/resources/" class="nav-link">
  Resources
</a></div><div class="nav-item"><a href="/caliban/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/caliban/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/ghostdogpr/caliban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://javadoc.io/doc/com.github.ghostdogpr/caliban_2.12/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Scaladoc
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Caliban</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/caliban/docs/" aria-current="page" class="sidebar-link">Getting Started</a></li><li><a href="/caliban/docs/schema.html" class="sidebar-link">Schemas</a></li><li><a href="/caliban/docs/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/caliban/docs/optimization.html" class="sidebar-link">Query optimization</a></li><li><a href="/caliban/docs/validation.html" class="sidebar-link">Validation</a></li><li><a href="/caliban/docs/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/caliban/docs/interop.html" class="sidebar-link">Interop</a></li><li><a href="/caliban/docs/client.html" class="sidebar-link">GraphQL Client</a></li><li><a href="/caliban/docs/federation.html" class="sidebar-link">Federation</a></li><li><a href="/caliban/docs/stitching.html" aria-current="page" class="active sidebar-link">Stitching</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/caliban/docs/stitching.html#dependencies" class="sidebar-link">Dependencies</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/stitching.html#stitching-in-action" class="sidebar-link">Stitching in Action</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/stitching.html#things-not-yet-supported" class="sidebar-link">Things not yet supported</a></li></ul></li><li><a href="/caliban/docs/tools.html" class="sidebar-link">Tools</a></li><li><a href="/caliban/docs/examples.html" class="sidebar-link">Examples</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="stitching"><a href="#stitching" class="header-anchor">#</a> Stitching</h1> <p><strong>Stitching</strong> is a part of <code>caliban-tools</code> which can be used to use parts of another GraphQL API from an API you're building in situations where using Apollo federation isn't an option. You can also use it to fully subsume and proxy another GraphQL schema.</p> <p>In general, Federation should be your preferred choice.</p> <p>You should also be careful when using stitching since it's very easy to pull in large parts of an external schema's types and structure into your API. This can make it error prone since the likelihood that you'll get type clashes between your API and the API you're stitching in quickly increases.</p> <h2 id="dependencies"><a href="#dependencies" class="header-anchor">#</a> Dependencies</h2> <p>In order to use stitching, add <code>caliban-tools</code> to your dependencies:</p> <div class="language-scala extra-class"><pre class="language-scala"><code>libraryDependencies <span class="token operator">+=</span> <span class="token string">&quot;com.github.ghostdogpr&quot;</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token string">&quot;caliban-tools&quot;</span> <span class="token operator">%</span> <span class="token string">&quot;1.2.0&quot;</span>
</code></pre></div><h2 id="stitching-in-action"><a href="#stitching-in-action" class="header-anchor">#</a> Stitching in Action</h2> <p>Let's start out by defining our API. We'll have <code>AppUser</code> profiles, that has a linked <code>featuredRepository</code>. For the <code>featuredRepository</code>, we want to leverage <a href="https://docs.github.com/en/graphql" target="_blank" rel="noopener noreferrer">Github's GraphQL API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">object</span> StitchingExample <span class="token keyword">extends</span> GenericSchema<span class="token punctuation">[</span>ZEnv<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token keyword">class</span> AppUser<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> featuredRepository<span class="token operator">:</span> Repository<span class="token punctuation">)</span>
  <span class="token keyword">case</span> <span class="token keyword">class</span> Repository<span class="token punctuation">(</span>owner<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>

  <span class="token keyword">case</span> <span class="token keyword">class</span> GetUserQuery<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> repository<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>

  <span class="token keyword">case</span> <span class="token keyword">class</span> Queries<span class="token punctuation">(</span>
    GetUser<span class="token operator">:</span> GetUserQuery <span class="token keyword">=&gt;</span> URIO<span class="token punctuation">[</span>ZEnv<span class="token punctuation">,</span> AppUser<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

  graphQL<span class="token punctuation">(</span>
    RootResolver<span class="token punctuation">(</span>
      Queries<span class="token punctuation">(</span>
        GetUser <span class="token operator">=</span> query <span class="token keyword">=&gt;</span>
          random<span class="token punctuation">.</span>nextUUID<span class="token punctuation">.</span>map<span class="token punctuation">(</span>uuid <span class="token keyword">=&gt;</span>
            AppUser<span class="token punctuation">(</span>
              id <span class="token operator">=</span> uuid<span class="token punctuation">.</span>toString<span class="token punctuation">,</span>
              name <span class="token operator">=</span> query<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
              featuredRepository <span class="token operator">=</span> Repository<span class="token punctuation">(</span>query<span class="token punctuation">.</span>name<span class="token punctuation">,</span> query<span class="token punctuation">.</span>repository<span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now let's integrate with the Github API!</p> <p>In order to do this we're going to do a couple of things:</p> <ol><li>Load the introspection schema from Github's API</li> <li>Parse the introspected schema into a <code>caliban.introspection.adt.__Schema</code></li> <li>Use the parsed schema to generate an <code>implicit Schema[R, A]</code> for the entities we're stitching. This effectively replaces our own schema with one from Github.</li> <li>Teach our implicit schema how to map our local resolver to a query that can be resolved remotely by calling Github's API.</li></ol> <div class="language-scala extra-class"><pre class="language-scala"><code>  <span class="token keyword">val</span> GITHUB_API <span class="token operator">=</span> <span class="token string">&quot;https://api.github.com/graphql&quot;</span>

  <span class="token keyword">val</span> api <span class="token operator">=</span> <span class="token keyword">for</span> <span class="token punctuation">{</span>
    sttpClient           <span class="token keyword">&lt;-</span> ZIO<span class="token punctuation">.</span>environment<span class="token punctuation">[</span>SttpClient<span class="token punctuation">]</span>
    <span class="token comment">// 1</span>
    schemaLoader          <span class="token operator">=</span> SchemaLoader<span class="token punctuation">.</span>fromIntrospection<span class="token punctuation">(</span>GITHUB_API<span class="token punctuation">,</span> None<span class="token punctuation">)</span>
    schema               <span class="token keyword">&lt;-</span> schemaLoader<span class="token punctuation">.</span>load
    <span class="token comment">// 2</span>
    remoteSchema         <span class="token keyword">&lt;-</span> ZIO<span class="token punctuation">.</span>fromOption<span class="token punctuation">(</span>RemoteSchema<span class="token punctuation">.</span>parseRemoteSchema<span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">)</span>
    remoteSchemaResolvers <span class="token operator">=</span> RemoteSchemaResolver<span class="token punctuation">.</span>fromSchema<span class="token punctuation">(</span>remoteSchema<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">yield</span> <span class="token punctuation">{</span>
    <span class="token comment">// 3</span>
    <span class="token keyword">implicit</span> <span class="token keyword">val</span> githubProfileSchema<span class="token operator">:</span> Schema<span class="token punctuation">[</span>ZEnv<span class="token punctuation">,</span> Repository<span class="token punctuation">]</span> <span class="token operator">=</span>
      remoteSchemaResolvers
        <span class="token punctuation">.</span>remoteResolver<span class="token punctuation">(</span><span class="token string">&quot;Repository&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
          <span class="token comment">// 4</span>
          <span class="token comment">// Here we need to translate our local `Repository` case class into</span>
          <span class="token comment">// a top-level query which can be issued towards Github's API.</span>
          <span class="token comment">// We do this by accepting a `caliban.execution.Field`, representing</span>
          <span class="token comment">// all the selected fields for a repository and map that to the</span>
          <span class="token comment">// top-level `repository` query in the Github API.</span>
          <span class="token comment">// This means the final query will end up looking something like this:</span>
          <span class="token comment">// query {</span>
          <span class="token comment">//   repository(owner: r.args.owner, name: r.args.name) {</span>
          <span class="token comment">// .   &lt;incoming query&gt;</span>
          <span class="token comment">//   }</span>
          <span class="token comment">// }</span>
          RemoteResolver<span class="token punctuation">.</span>fromFunction<span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token operator">:</span> ResolveRequest<span class="token punctuation">[</span>Repository<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
            r<span class="token punctuation">.</span>field<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>
              name <span class="token operator">=</span> <span class="token string">&quot;repository&quot;</span><span class="token punctuation">,</span>
              arguments <span class="token operator">=</span> Map<span class="token punctuation">(</span>
                <span class="token string">&quot;owner&quot;</span> <span class="token operator">-&gt;</span> Value<span class="token punctuation">.</span>StringValue<span class="token punctuation">(</span>r<span class="token punctuation">.</span>args<span class="token punctuation">.</span>owner<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;name&quot;</span>  <span class="token operator">-&gt;</span> Value<span class="token punctuation">.</span>StringValue<span class="token punctuation">(</span>r<span class="token punctuation">.</span>args<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> RemoteResolver<span class="token punctuation">.</span>fromUrl<span class="token punctuation">(</span>GITHUB_API<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>provide<span class="token punctuation">(</span>sttpClient<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>However, when running this we will experience failing requests due to <code>401 Unauthorized</code>. This is because all queries to Github's API requires authorization to be provided. In order to fix this, we need to add authorization to both the introspection query as well as our remote resolver. We also need a config module that can provide us with a Github token based on the value of <code>GITHUB_TOKEN</code> in our environment.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">case</span> <span class="token keyword">class</span> Configuration<span class="token punctuation">(</span>githubToken<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span>

<span class="token keyword">object</span> Configuration <span class="token punctuation">{</span>
  <span class="token keyword">def</span> fromEnvironment <span class="token operator">=</span>
    <span class="token punctuation">(</span><span class="token keyword">for</span> <span class="token punctuation">{</span>
      githubToken <span class="token keyword">&lt;-</span> read<span class="token punctuation">(</span><span class="token string">&quot;GITHUB_TOKEN&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">yield</span> Configuration<span class="token punctuation">(</span>githubToken<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toLayer

  <span class="token keyword">private</span> <span class="token keyword">def</span> read<span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> Task<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> Task<span class="token punctuation">.</span>effect<span class="token punctuation">(</span>
    sys<span class="token punctuation">.</span>env<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can now update the introspection query to use our token:</p> <div class="language-scala extra-class"><pre class="language-scala"><code>  <span class="token keyword">val</span> api <span class="token operator">=</span> <span class="token keyword">for</span> <span class="token punctuation">{</span>
    config     <span class="token keyword">&lt;-</span> ZIO<span class="token punctuation">.</span>environment<span class="token punctuation">[</span>Has<span class="token punctuation">[</span>Configuration<span class="token punctuation">]</span><span class="token punctuation">]</span>
    schemaLoader <span class="token operator">=</span> SchemaLoader<span class="token punctuation">.</span>fromIntrospection<span class="token punctuation">(</span>
                     GITHUB_API<span class="token punctuation">,</span>
                     Some<span class="token punctuation">(</span>
                       List<span class="token punctuation">(</span>
                         Options<span class="token punctuation">.</span>Header<span class="token punctuation">(</span>
                           <span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span>
                           s<span class="token string">&quot;Bearer ${config.get.githubToken}&quot;</span>
                         <span class="token punctuation">)</span>
                       <span class="token punctuation">)</span>
                     <span class="token punctuation">)</span>
                   <span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>  <span class="token keyword">yield</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>
</code></pre></div><p>as well as update our resolver to authorize our request.</p> <p>In order to do this, we can use <code>RemoteResolver[R, E, A, B]</code> which lets us compose resolution steps via <code>&gt;&gt;&gt;</code>.</p> <p>In order to make this code easier, we can extract the mechanics around sending the actual request:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> apiRequest <span class="token operator">=</span>
    RemoteResolver<span class="token punctuation">.</span>toQuery <span class="token operator">&gt;&gt;&gt;</span> RemoteResolver<span class="token punctuation">.</span>request<span class="token punctuation">(</span>GITHUB_API<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> RemoteResolver<span class="token punctuation">.</span>fromFunctionM<span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token operator">:</span> HttpRequest<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
        config <span class="token keyword">&lt;-</span> ZIO<span class="token punctuation">.</span>service<span class="token punctuation">[</span>Configuration<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">yield</span> r<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">,</span> s<span class="token string">&quot;Bearer ${config.githubToken}&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> RemoteResolver<span class="token punctuation">.</span>execute <span class="token operator">&gt;&gt;&gt;</span> RemoteResolver<span class="token punctuation">.</span>unwrap
</code></pre></div><p>And now we can use our new <code>apiRequest</code> when resolving our <code>Schema[ZEnv, Repository]</code>:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">implicit</span> <span class="token keyword">val</span> githubProfileSchema<span class="token operator">:</span> Schema<span class="token punctuation">[</span>ZEnv<span class="token punctuation">,</span> Repository<span class="token punctuation">]</span> <span class="token operator">=</span>
  remoteSchemaResolvers
  <span class="token punctuation">.</span>remoteResolver<span class="token punctuation">(</span><span class="token string">&quot;Repository&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
      RemoteResolver<span class="token punctuation">.</span>fromFunction<span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token operator">:</span> ResolveRequest<span class="token punctuation">[</span>Repository<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
      r<span class="token punctuation">.</span>field<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>
          name <span class="token operator">=</span> <span class="token string">&quot;repository&quot;</span><span class="token punctuation">,</span>
          arguments <span class="token operator">=</span> Map<span class="token punctuation">(</span>
            <span class="token string">&quot;owner&quot;</span> <span class="token operator">-&gt;</span> Value<span class="token punctuation">.</span>StringValue<span class="token punctuation">(</span>r<span class="token punctuation">.</span>args<span class="token punctuation">.</span>owner<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span>  <span class="token operator">-&gt;</span> Value<span class="token punctuation">.</span>StringValue<span class="token punctuation">(</span>r<span class="token punctuation">.</span>args<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> apiRequest
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>provide<span class="token punctuation">(</span>sttpClient <span class="token operator">++</span> config<span class="token punctuation">)</span>
</code></pre></div><p>All that's left to do is to hook up to an HTTP server and configure a Github API token. And now you have an API that can handle queries such as these:</p> <div class="language-graphql extra-class"><pre class="language-graphql"><code><span class="token keyword">query</span> <span class="token punctuation">{</span>
  <span class="token property-query">GetUser</span><span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">:</span><span class="token string">&quot;ghostdogpr&quot;</span><span class="token punctuation">,</span> <span class="token attr-name">repository</span><span class="token punctuation">:</span><span class="token string">&quot;caliban&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
    <span class="token object">featuredRepository</span> <span class="token punctuation">{</span>
      <span class="token property-query">pullRequests</span><span class="token punctuation">(</span><span class="token attr-name">states</span><span class="token punctuation">:</span> <span class="token constant">OPEN</span><span class="token punctuation">,</span> <span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token object">edges</span> <span class="token punctuation">{</span>
          <span class="token object">node</span> <span class="token punctuation">{</span>
            <span class="token property">title</span>
            <span class="token object">author</span> <span class="token punctuation">{</span>
              <span class="token property">login</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>See the <a href="https://github.com/ghostdogpr/caliban/tree/master/examples/src/main/scala/example/stitching" target="_blank" rel="noopener noreferrer">examples directory<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for a full example.</p> <h2 id="things-not-yet-supported"><a href="#things-not-yet-supported" class="header-anchor">#</a> Things not yet supported</h2> <ul><li>Type renaming.</li> <li>Type conflict resolution strategies.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/caliban/docs/federation.html" class="prev">
        Federation
      </a></span> <span class="next"><a href="/caliban/docs/tools.html">
        Tools
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/caliban/assets/js/app.c9beaf5a.js" defer></script><script src="/caliban/assets/js/2.caf3e0bc.js" defer></script><script src="/caliban/assets/js/18.e3d75065.js" defer></script>
  </body>
</html>

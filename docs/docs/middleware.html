<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middleware | Caliban</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/caliban/caliban.png">
    <meta name="description" content="Functional GraphQL library for Scala">
    
    <link rel="preload" href="/caliban/assets/css/0.styles.5378620b.css" as="style"><link rel="preload" href="/caliban/assets/js/app.86099f15.js" as="script"><link rel="preload" href="/caliban/assets/js/2.bfa611b1.js" as="script"><link rel="preload" href="/caliban/assets/js/15.a8dac9a5.js" as="script"><link rel="prefetch" href="/caliban/assets/js/10.38f9edbf.js"><link rel="prefetch" href="/caliban/assets/js/11.d4680226.js"><link rel="prefetch" href="/caliban/assets/js/12.a2927852.js"><link rel="prefetch" href="/caliban/assets/js/13.c5d0bc6f.js"><link rel="prefetch" href="/caliban/assets/js/14.742721da.js"><link rel="prefetch" href="/caliban/assets/js/16.a4da555a.js"><link rel="prefetch" href="/caliban/assets/js/17.8415a9ba.js"><link rel="prefetch" href="/caliban/assets/js/18.2ff19fb5.js"><link rel="prefetch" href="/caliban/assets/js/19.60515bb0.js"><link rel="prefetch" href="/caliban/assets/js/20.f81c30f7.js"><link rel="prefetch" href="/caliban/assets/js/21.20a95ff5.js"><link rel="prefetch" href="/caliban/assets/js/3.60419601.js"><link rel="prefetch" href="/caliban/assets/js/4.e05c873c.js"><link rel="prefetch" href="/caliban/assets/js/5.76fc70b2.js"><link rel="prefetch" href="/caliban/assets/js/6.498ab014.js"><link rel="prefetch" href="/caliban/assets/js/7.3f5168c2.js"><link rel="prefetch" href="/caliban/assets/js/8.c1aa998a.js"><link rel="prefetch" href="/caliban/assets/js/9.d565ae5e.js">
    <link rel="stylesheet" href="/caliban/assets/css/0.styles.5378620b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/caliban/" class="home-link router-link-active"><img src="/caliban/caliban.svg" alt="Caliban" class="logo"> <span class="site-name can-hide">Caliban</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/caliban/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/caliban/resources/" class="nav-link">
  Resources
</a></div><div class="nav-item"><a href="/caliban/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/caliban/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/ghostdogpr/caliban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://javadoc.io/doc/com.github.ghostdogpr/caliban_2.12/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Scaladoc
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/caliban/docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/caliban/resources/" class="nav-link">
  Resources
</a></div><div class="nav-item"><a href="/caliban/faq/" class="nav-link">
  FAQ
</a></div><div class="nav-item"><a href="/caliban/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/ghostdogpr/caliban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://javadoc.io/doc/com.github.ghostdogpr/caliban_2.12/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Scaladoc
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Caliban</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/caliban/docs/" aria-current="page" class="sidebar-link">Getting Started</a></li><li><a href="/caliban/docs/schema.html" class="sidebar-link">Schemas</a></li><li><a href="/caliban/docs/middleware.html" aria-current="page" class="active sidebar-link">Middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/caliban/docs/middleware.html#wrapper-types" class="sidebar-link">Wrapper types</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/middleware.html#pre-defined-wrappers" class="sidebar-link">Pre-defined wrappers</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/middleware.html#wrapping-the-interpreter" class="sidebar-link">Wrapping the interpreter</a></li><li class="sidebar-sub-header"><a href="/caliban/docs/middleware.html#customizing-error-responses" class="sidebar-link">Customizing error responses</a></li></ul></li><li><a href="/caliban/docs/optimization.html" class="sidebar-link">Query optimization</a></li><li><a href="/caliban/docs/validation.html" class="sidebar-link">Validation</a></li><li><a href="/caliban/docs/introspection.html" class="sidebar-link">Introspection</a></li><li><a href="/caliban/docs/interop.html" class="sidebar-link">Interop</a></li><li><a href="/caliban/docs/client.html" class="sidebar-link">GraphQL Client</a></li><li><a href="/caliban/docs/federation.html" class="sidebar-link">Federation</a></li><li><a href="/caliban/docs/tools.html" class="sidebar-link">Tools</a></li><li><a href="/caliban/docs/examples.html" class="sidebar-link">Examples</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h1> <p>Caliban allows you to perform additional actions at various levels of a query processing, via the concept of <code>Wrapper</code>. Using wrappers, you can:</p> <ul><li>verify that a query doesn't reach some limit (e.g. depth, complexity)</li> <li>modify a query before it's executed</li> <li>add timeouts to queries or fields</li> <li>log each field execution time</li> <li>support <a href="https://github.com/apollographql/apollo-tracing" target="_blank" rel="noopener noreferrer">Apollo Tracing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://github.com/apollographql/apollo-cache-control" target="_blank" rel="noopener noreferrer">Apollo Caching<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or anything similar</li> <li>etc.</li></ul> <h2 id="wrapper-types"><a href="#wrapper-types" class="header-anchor">#</a> Wrapper types</h2> <p>There are 6 basic types of wrappers:</p> <ul><li><code>OverallWrapper</code> to wrap the whole query processing</li> <li><code>ParsingWrapper</code> to wrap the query parsing only</li> <li><code>ValidationWrapper</code> to wrap the query validation only</li> <li><code>ExecutionWrapper</code> to wrap the query execution only</li> <li><code>FieldWrapper</code> to wrap each field execution</li> <li><code>IntrospectionWrapper</code> to wrap the introspection query only</li></ul> <p>Each one requires a function that takes a <code>ZIO</code> or <code>ZQuery</code> computation together with some contextual information (e.g. the query string) and should return another computation.</p> <p>Let's see how to implement a wrapper that times out the whole query if its processing takes longer that 1 minute.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> wrapper <span class="token operator">=</span> OverallWrapper <span class="token punctuation">{</span> process <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> GraphQLRequest<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
  process<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>timeout<span class="token punctuation">(</span><span class="token number">1</span> minute<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>map<span class="token punctuation">(</span>
      _<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>
        GraphQLResponse<span class="token punctuation">(</span>
          NullValue<span class="token punctuation">,</span>
          List<span class="token punctuation">(</span>ExecutionError<span class="token punctuation">(</span>s<span class="token string">&quot;Query was interrupted after timeout of ${duration.render}:\n$query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>You can also combine wrappers using <code>|+|</code> and create a wrapper that requires an effect to be run at each query using <code>EffectfulWrapper</code>.</p> <p>To use your wrapper, call <code>GraphQL#withWrapper</code> or its alias <code>@@</code>.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> api <span class="token operator">=</span> graphQL<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span>withWrapper<span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span>
<span class="token comment">// or</span>
<span class="token keyword">val</span> api <span class="token operator">=</span> graphQL<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @@ wrapper
</code></pre></div><h2 id="pre-defined-wrappers"><a href="#pre-defined-wrappers" class="header-anchor">#</a> Pre-defined wrappers</h2> <p>Caliban comes with a few pre-made wrappers in <code>caliban.wrappers.Wrappers</code>:</p> <ul><li><code>maxDepth</code> returns a wrapper that fails queries whose depth is higher than a given value</li> <li><code>maxFields</code> returns a wrapper that fails queries whose number of fields is higher than a given value</li> <li><code>timeout</code> returns a wrapper that fails queries taking more than a specified time</li> <li><code>printErrors</code> returns a wrapper that prints errors</li> <li><code>printSlowQueries</code> returns a wrapper that prints slow queries</li> <li><code>onSlowQueries</code> returns a wrapper that can run a given function on slow queries</li></ul> <p>In addition to those, Caliban also ships with some non-spec but standard wrappers</p> <ul><li><code>caliban.wrappers.ApolloTracing.apolloTracing</code> returns a wrapper that adds tracing data into the <code>extensions</code> field of each response following <a href="https://github.com/apollographql/apollo-tracing" target="_blank" rel="noopener noreferrer">Apollo Tracing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> format.</li> <li><code>caliban.wrappers.ApolloCaching.apolloCaching</code> returns a wrapper that adds caching hints to properly annotated fields using the <a href="https://github.com/apollographql/apollo-cache-control" target="_blank" rel="noopener noreferrer">Apollo Caching<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> format.</li> <li><code>caliban.wrappers.ApolloPersistedQueries.apolloPersistedQueries</code> returns a wrapper that caches and retrieves query using a hash using the <a href="https://github.com/apollographql/apollo-link-persisted-queries" target="_blank" rel="noopener noreferrer">Apollo Persisted Queries<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> format.</li></ul> <p>They can be used like this:</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> api <span class="token operator">=</span>
  graphQL<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @@
    maxDepth<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> @@
    timeout<span class="token punctuation">(</span><span class="token number">3</span> seconds<span class="token punctuation">)</span> @@
    printSlowQueries<span class="token punctuation">(</span><span class="token number">500</span> millis<span class="token punctuation">)</span> @@
    apolloTracing @@
    apolloCaching
</code></pre></div><h2 id="wrapping-the-interpreter"><a href="#wrapping-the-interpreter" class="header-anchor">#</a> Wrapping the interpreter</h2> <p>All the wrappers mentioned above require that you don't modify the environment <code>R</code> and the error type which is always a <code>CalibanError</code>. It is also possible to wrap your <code>GraphQLInterpreter</code> by calling <code>wrapExecutionWith</code> on it. This method takes in a function <code>f</code> and returns a new <code>GraphQLInterpreter</code> that will wrap the <code>execute</code> method with this function <code>f</code>.</p> <p>It is used internally to implement <code>mapError</code> (customize errors) and <code>provide</code> (eliminate the environment), but you can use it for other purposes such as adding a general timeout, logging response times, etc.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> i<span class="token operator">:</span> GraphQLInterpreter<span class="token punctuation">[</span>MyEnv<span class="token punctuation">,</span> CalibanError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>

<span class="token comment">// change error type to String</span>
<span class="token keyword">val</span> i2<span class="token operator">:</span> GraphQLInterpreter<span class="token punctuation">[</span>MyEnv<span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">.</span>mapError<span class="token punctuation">(</span>_<span class="token punctuation">.</span>toString<span class="token punctuation">)</span>

<span class="token comment">// provide the environment</span>
<span class="token keyword">val</span> i3<span class="token operator">:</span> GraphQLInterpreter<span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span> CalibanError<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">.</span>provide<span class="token punctuation">(</span>myEnv<span class="token punctuation">)</span>

<span class="token comment">// add a timeout on every query execution</span>
<span class="token keyword">val</span> i4<span class="token operator">:</span> GraphQLInterpreter<span class="token punctuation">[</span>MyEnv <span class="token keyword">with</span> Clock<span class="token punctuation">,</span> CalibanError<span class="token punctuation">]</span> <span class="token operator">=</span>
  i<span class="token punctuation">.</span>wrapExecutionWith<span class="token punctuation">(</span>
    _<span class="token punctuation">.</span>timeout<span class="token punctuation">(</span><span class="token number">30</span> seconds<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>
      _<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>GraphQLResponse<span class="token punctuation">(</span>NullValue<span class="token punctuation">,</span> List<span class="token punctuation">(</span>ExecutionError<span class="token punctuation">(</span><span class="token string">&quot;Timeout!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
</code></pre></div><h2 id="customizing-error-responses"><a href="#customizing-error-responses" class="header-anchor">#</a> Customizing error responses</h2> <p>During various phases of executing a query, an error may occur. Caliban renders the different instances of <code>CalibanError</code> to a GraphQL spec compliant response. As a user, you will most likely encounter <code>ExecutionError</code> at some point because this will encapsulate the errors in the error channel of your effects. For Caliban to be able to render some basic message about the error that occured during query execution, it is important that your error extends <code>Throwable</code>.</p> <p>For more meaningful error handling, GraphQL spec allows for an <a href="http://spec.graphql.org/June2018/#example-fce18" target="_blank" rel="noopener noreferrer"><code>extension</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> object in the error response. This object may include, for instance, <code>code</code> information to model enum-like error codes that can be handled by a front-end. In order to generate this information, one can use the <code>mapError</code> function on a <code>GraphQLInterpreter</code>. An example is provided below in which we map a custom domain error within an <code>ExecutionError</code> to a meaningful error code.</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">sealed</span> <span class="token keyword">trait</span> ExampleAppEncodableError <span class="token keyword">extends</span> Throwable <span class="token punctuation">{</span>
    <span class="token keyword">def</span> errorCode<span class="token operator">:</span> <span class="token builtin">String</span>
<span class="token punctuation">}</span>
<span class="token keyword">case</span> <span class="token keyword">object</span> UnauthorizedError <span class="token keyword">extends</span> ExampleAppEncodableError <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> errorCode<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">&quot;UNAUTHORIZED&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> withErrorCodeExtensions<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">(</span>
  interpreter<span class="token operator">:</span> GraphQLInterpreter<span class="token punctuation">[</span>R<span class="token punctuation">,</span> CalibanError<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token operator">:</span> GraphQLInterpreter<span class="token punctuation">[</span>R<span class="token punctuation">,</span> CalibanError<span class="token punctuation">]</span> <span class="token operator">=</span> interpreter<span class="token punctuation">.</span>mapError <span class="token punctuation">{</span>
  <span class="token keyword">case</span> err @ ExecutionError<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> Some<span class="token punctuation">(</span>exampleError<span class="token operator">:</span> ExampleAppEncodableError<span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
    err<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>extensions <span class="token operator">=</span> Some<span class="token punctuation">(</span>ObjectValue<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;errorCode&quot;</span><span class="token punctuation">,</span> StringValue<span class="token punctuation">(</span>exampleError<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">case</span> err<span class="token operator">:</span> ExecutionError <span class="token keyword">=&gt;</span>
    err<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>extensions <span class="token operator">=</span> Some<span class="token punctuation">(</span>ObjectValue<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;errorCode&quot;</span><span class="token punctuation">,</span> StringValue<span class="token punctuation">(</span><span class="token string">&quot;EXECUTION_ERROR&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">case</span> err<span class="token operator">:</span> ValidationError <span class="token keyword">=&gt;</span>
    err<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>extensions <span class="token operator">=</span> Some<span class="token punctuation">(</span>ObjectValue<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;errorCode&quot;</span><span class="token punctuation">,</span> StringValue<span class="token punctuation">(</span><span class="token string">&quot;VALIDATION_ERROR&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">case</span> err<span class="token operator">:</span> ParsingError <span class="token keyword">=&gt;</span>
    err<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>extensions <span class="token operator">=</span> Some<span class="token punctuation">(</span>ObjectValue<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;errorCode&quot;</span><span class="token punctuation">,</span> StringValue<span class="token punctuation">(</span><span class="token string">&quot;PARSING_ERROR&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/caliban/docs/schema.html" class="prev">
        Schemas
      </a></span> <span class="next"><a href="/caliban/docs/optimization.html">
        Query optimization
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/caliban/assets/js/app.86099f15.js" defer></script><script src="/caliban/assets/js/2.bfa611b1.js" defer></script><script src="/caliban/assets/js/15.a8dac9a5.js" defer></script>
  </body>
</html>

(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{281:function(t,e,a){"use strict";a.r(e);var s=a(14),n=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"http-adapters"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http-adapters"}},[t._v("#")]),t._v(" Http Adapters")]),t._v(" "),e("p",[t._v('Once you have an interpreter able to execute GraphQL queries, you usually want to expose it using an HTTP API.\nCaliban comes with a few "ready-to-use" components (called "adapters") to expose your API with the most popular HTTP libraries.')]),t._v(" "),e("p",[t._v("Under the hood, adapters use the "),e("a",{attrs:{href:"https://tapir.softwaremill.com/en/latest/",target:"_blank",rel:"noopener noreferrer"}},[t._v("tapir"),e("OutboundLink")],1),t._v(" library, so you can easily create a custom adapter with anything that tapir supports.")]),t._v(" "),e("h2",{attrs:{id:"built-in-adapters"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#built-in-adapters"}},[t._v("#")]),t._v(" Built-in adapters")]),t._v(" "),e("p",[t._v("Each built-in adapter comes with 3 main functions:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("makeHttpService")]),t._v(" takes an interpreter and turns it into a route following the "),e("a",{attrs:{href:"https://graphql.org/learn/serving-over-http/#http-methods-headers-and-body",target:"_blank",rel:"noopener noreferrer"}},[t._v("standard GraphQL protocol"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("code",[t._v("makeHttpUploadService")]),t._v(" takes an interpreter and turns it into a route following the "),e("a",{attrs:{href:"https://github.com/jaydenseric/graphql-multipart-request-spec",target:"_blank",rel:"noopener noreferrer"}},[t._v("GraphQL multipart request protocol"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("code",[t._v("makeWebSocketService")]),t._v(" takes an interpreter and turns it into a route following the "),e("a",{attrs:{href:"https://github.com/enisdenjo/graphql-ws/blob/master/PROTOCOL.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("GraphQL WebSocket protocol"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("Each of these functions also support a few parameters:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("skipValidation")]),t._v(" (default: false) allows skipping validation when executing requests")]),t._v(" "),e("li",[e("code",[t._v("enableIntrospection")]),t._v(" (default: true) allows disabling introspection")]),t._v(" "),e("li",[e("code",[t._v("queryExecution")]),t._v(" (default: Parallel) defines how query optimization should work")]),t._v(" "),e("li",[e("code",[t._v("requestInterceptor")]),t._v(" (default: empty) allows intercepting data from the request (e.g. headers) and do something with it (e.g. save it inside ZIO env)")]),t._v(" "),e("li",[e("code",[t._v("webSocketHooks")]),t._v(" (default: empty) gives you some hooks around the WebSocket lifecycle (useful for authentication)")])]),t._v(" "),e("p",[t._v("The following adapters are provided:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Http4sAdapter")]),t._v(" exposes a route for http4s.")]),t._v(" "),e("li",[e("code",[t._v("ZHttpAdapter")]),t._v(" exposes a route for zio-http. This one doesn't support uploads yet.")]),t._v(" "),e("li",[e("code",[t._v("PlayHttpAdapter")]),t._v(" exposes a route for play.")]),t._v(" "),e("li",[e("code",[t._v("AkkaHttpAdapter")]),t._v(" exposes a route for akka.")])]),t._v(" "),e("p",[t._v("Want to use something else? Check "),e("a",{attrs:{href:"#make-your-own-adapter"}},[t._v("make your own adapter section")]),t._v("!")]),t._v(" "),e("p",[t._v("Make sure to check the "),e("RouterLink",{attrs:{to:"/docs/examples.html"}},[t._v("examples")]),t._v(" to see the adapters in action.")],1),t._v(" "),e("h2",{attrs:{id:"json-handling"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#json-handling"}},[t._v("#")]),t._v(" Json handling")]),t._v(" "),e("p",[t._v("Caliban comes with JSON encoders and decoders for the following libraries:")]),t._v(" "),e("ul",[e("li",[t._v("circe")]),t._v(" "),e("li",[t._v("jsoniter-scala (JDK 11+ only)")]),t._v(" "),e("li",[t._v("play-json")]),t._v(" "),e("li",[t._v("zio-json")])]),t._v(" "),e("p",[t._v("Since v2.1.0, the adapters are not bound to a specific JSON handler and require the user to add the "),e("RouterLink",{attrs:{to:"/docs/#dependencies"}},[t._v("corresponding dependency")]),t._v(" in their project and import the implicits in scope when calling the "),e("code",[t._v("makeHttpService")]),t._v(" / "),e("code",[t._v("makeHttpUploadService")]),t._v(" / "),e("code",[t._v("makeWebSocketService")]),t._v(" methods.")],1),t._v(" "),e("p",[t._v("Let's say we want to use "),e("code",[t._v("http4s")]),t._v(" as the server implementation with "),e("code",[t._v("zio-json")]),t._v(" as the json handler. Defining the http4s route is as simple as:")]),t._v(" "),e("div",{staticClass:"language-scala extra-class"},[e("pre",{pre:!0,attrs:{class:"language-scala"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" http4sRoute "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("sttp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tapir"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("zio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("_\n  Http4sAdapter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makeHttpService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("interpreter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("That's it! "),e("code",[t._v("http4sRoute")]),t._v(" is a valid http4s route ready to serve our API.")]),t._v(" "),e("p",[t._v("If you use another json library, you will need to create encoders and decoders for it (which is very simple, you can simply look at the existing ones).\nThe full list of JSON libraries supported by Tapir can be found "),e("a",{attrs:{href:"https://tapir.softwaremill.com/en/latest/endpoint/json.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Known issues: jsoniter-scala")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("makeHttpUploadService")]),t._v(" methods require an implicit of "),e("code",[t._v("JsonCodec[Map[String,Seq[String]]]")]),t._v(" in scope. Jsoniter does not provide\ncodecs for common types by default, which means the user needs to create one. To do so, add the "),e("code",[t._v("jsoniter-scala-macros")]),t._v(" dependency to your project and create one as:")]),t._v(" "),e("div",{staticClass:"language-scala extra-class"},[e("pre",{pre:!0,attrs:{class:"language-scala"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("sttp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tapir"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsoniter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("_\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plokhotnyuk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsoniter_scala"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("_\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plokhotnyuk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsoniter_scala"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("macros"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("_\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" http4sRoute "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("sttp"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tapir"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsoniter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("_\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implicit")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" codec"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" JsonValueCodec"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Map"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Seq"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" JsonCodecMaker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("make\n\n  Http4sAdapter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makeHttpUploadService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("interpreter"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("To maximize performance, the "),e("strong",[t._v("jsoniter")]),t._v(" codec implementation is stack-recursive. To prevent stack overflow errors, it has a "),e("strong",[t._v("maximum depth limit of 512")]),t._v(".")]),t._v(" "),e("p",[t._v("If your schema contains recursive types and want to use the jsoniter codecs, make sure to also limit the maximum query depth using\nthe "),e("RouterLink",{attrs:{to:"/docs/middleware.html#pre-defined-wrappers"}},[t._v("maxDepth wrapper")]),t._v(".")],1)])]),t._v(" "),e("h2",{attrs:{id:"make-your-own-adapter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#make-your-own-adapter"}},[t._v("#")]),t._v(" Make your own adapter")]),t._v(" "),e("p",[t._v("All existing adapters are actually using a common adapter under the hood, called "),e("code",[t._v("TapirAdapter")]),t._v(".")]),t._v(" "),e("p",[t._v("This adapter, available in the "),e("code",[t._v("caliban-tapir")]),t._v(" dependency which has the same 3 methods "),e("code",[t._v("makeHttpService")]),t._v(", "),e("code",[t._v("makeHttpUploadService")]),t._v(" and "),e("code",[t._v("makeWebSocketService")]),t._v(".")]),t._v(" "),e("p",[t._v("The main differences between these and the methods from the built-in adapters is that they return one or several tapir "),e("code",[t._v("ServerEndpoint")]),t._v(",\nwhich you can then pass to a tapir interpreter. The returned "),e("code",[t._v("ServerEndpoint")]),t._v(" use "),e("code",[t._v("RIO[R, *]")]),t._v(" as an effect type, but you can easily transform it to another effect type. A helper "),e("code",[t._v("convertHttpEndpointToFuture")]),t._v(" allows converting the effect type to a scala "),e("code",[t._v("Future")]),t._v(" (this is used in the Akka and Play interpreters).")])])}),[],!1,null,null,null);e.default=n.exports}}]);